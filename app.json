[{"name":"app.R","content":"# Rock_K App -------------------------------------------------------------------\r\n\r\n# Load libraries ---------------------------------------------------------------\r\nlibrary(shiny)\r\nlibrary(bslib)\r\n# library(remotes)\r\n# install_version(\"shinylive\", version = \"0.2.0\")\r\nlibrary(shinylive)\r\nlibrary(httpuv)\r\nlibrary(dplyr)\r\nlibrary(tidyr)\r\n#library(ggplot2)\r\nlibrary(hrbrthemes)\r\nlibrary(plotly)\r\n\r\n\r\n# Source helpers ---------------------------------------------------------------\r\nsource(file = \"helpers.R\")\r\n\r\n\r\n# Define UI for application ----------------------------------------------------\r\nui <- page_sidebar(\r\n\r\n  title = \"Rock Hydraulic Conductivity \",\r\n  withMathJax(),\r\n  # sidebar\r\n  sidebar = sidebar(\r\n  width = 350,\r\n  title = \"Formulations\",\r\n    card(\r\n      card_header(shinyLink(\r\n        to = \"https://doi.org/10.1002/2017JB014106\",\r\n        label = \"Achtziger-Zupancic et al. (2017)\"\r\n        )),\r\n      card_footer(\"\\\\(K = m \\\\cdot n \\\\cdot 10^{(A \\\\cdot \\\\log{z} + B)}\\\\)\"),\r\n       numericInput(\r\n        inputId = \"AZ_A\", \r\n        label = \"Coefficient A\",\r\n        value = -1.46\r\n      ),\r\n      numericInput(\r\n        inputId = \"AZ_B\", \r\n        label = \"Coefficient B\",\r\n        value = -16.48\r\n      ),\r\n      numericInput(\r\n        inputId = \"AZ_n\", \r\n        label = \"Anisotropy n\",\r\n        value = 10\r\n      ),\r\n      numericInput(\r\n        inputId = \"AZ_m\", \r\n        label = \"Multiplier m\",\r\n        value = 1\r\n      )\r\n    ),\r\n    card(\r\n      card_header(shinyLink(\r\n        to = \"https://doi.org/10.1029/2020JB020998\",\r\n        label = \"Snowdon et al. (2021)\"\r\n      )),\r\n      card_footer(\"\\\\(K = m \\\\cdot n \\\\cdot 10^{\\\\beta + \\\\frac{\\\\alpha - \\\\beta}{(1 + (\\\\frac{z}{\\\\gamma})^{\\\\delta)^{\\\\epsilon}}}}  \\\\)\"),\r\n      numericInput(\r\n        inputId = \"S_a\", \r\n        label = \"Coefficient \\\\(\\\\alpha\\\\)\",\r\n        value = -14.95\r\n      ),\r\n      numericInput(\r\n        inputId = \"S_b\", \r\n        label = \"Coefficient \\\\(\\\\beta\\\\)\",\r\n        value = -21\r\n      ),\r\n      numericInput(\r\n        inputId = \"S_y\", \r\n        label = \"Coefficient \\\\(\\\\gamma\\\\)\",\r\n        value = 205\r\n      ),\r\n      numericInput(\r\n        inputId = \"S_d\", \r\n        label = \"Coefficient \\\\(\\\\delta\\\\)\",\r\n        value = 3.16\r\n      ),\r\n      numericInput(\r\n        inputId = \"S_e\", \r\n        label = \"Coefficient \\\\(\\\\epsilon\\\\)\",\r\n        value = 0.279\r\n      ),\r\n      numericInput(\r\n        inputId = \"S_n\", \r\n        label = \"Anisotropy n\",\r\n        value = 10\r\n      ),\r\n      numericInput(\r\n        inputId = \"S_m\", \r\n        label = \"Multiplier m\",\r\n        value = 1\r\n      )\r\n    ),\r\n    card(\r\n      card_header(shinyLink(\r\n        to = \"https://doi.org/10.1029/2023WR035906\",\r\n        label = \"Gonzalez-Duque et al. (2024)\"\r\n      )),\r\n      card_footer(\"\\\\(K_z = \\\\begin{cases}\r\n                  K_S \\\\cdot e^{-A_S \\\\cdot z} \\\\text{, } z \\\\lt d_l \\\\\\\\\r\n                  10^{-A_d} \\\\cdot (\\\\frac{z}{D_d})^{-B_d} \\\\text{, } z \\\\geq d_l\r\n                  \\\\end{cases} \\\\)\"),\r\n      numericInput(\r\n        inputId = \"GD_Ks\",\r\n        label = \"\\\\(k_S \\\\text{, } m^2\\\\)\",\r\n        value = 5e-15\r\n      ),\r\n      numericInput(\r\n        inputId = \"GD_Kdl\", \r\n        label = \"\\\\(k_{d_l} \\\\text{, } m^2\\\\)\",\r\n        value = 1e-17\r\n      ),\r\n      numericInput(\r\n        inputId = \"GD_dl\", \r\n        label = \"\\\\(d_l \\\\text{, } km\\\\)\",\r\n        value = 1\r\n      ),\r\n      numericInput(\r\n        inputId = \"GD_Dd\", \r\n        label = \"\\\\(D_d \\\\text{, } km\\\\)\",\r\n        value = 1\r\n      ),\r\n      numericInput(\r\n        inputId = \"GD_Bd\", \r\n        label = \"\\\\(B_d \\\\text{, -}\\\\)\",\r\n        value = 3\r\n      ),\r\n      numericInput(\r\n        inputId = \"GD_n\", \r\n        label = \"Anisotropy n\",\r\n        value = 10\r\n      ),\r\n      numericInput(\r\n        inputId = \"GD_m\", \r\n        label = \"Multiplier m\",\r\n        value = 1\r\n      )\r\n    )\r\n\r\n  ),\r\n  # main panel\r\n  plotlyOutput(outputId = \"distPlotHK\"),\r\n  plotlyOutput(outputId = \"distPlotVK\")\r\n\r\n)\r\n\r\n# Define server logic ----------------------------------------------------------\r\nserver <- function(input, output) {\r\n\r\n  dataHK <- reactive({\r\n\r\n    data <- data.frame(\r\n      depth = c(2, seq(5, 45, 5), seq(50, 3500, 50))\r\n    ) %>%\r\n      mutate(\r\n        AZ = K_AZ(depth, input$AZ_A,  input$AZ_B, input$AZ_n, input$AZ_m),\r\n        S = K_S(depth, input$S_a, input$S_b, input$S_y, input$S_d,  input$S_e, input$S_n, input$S_m),\r\n        GD = K_GD(depth, input$GD_Ks, input$GD_Kdl, input$GD_dl, input$GD_Dd, input$GD_Bd, 1, input$GD_m)\r\n      ) %>%\r\n      tidyr::pivot_longer(\r\n        cols = !depth,\r\n        names_to = \"approach\",\r\n        values_to = \"values\"\r\n      ) %>%\r\n      mutate(approach = factor(\r\n        x = approach,\r\n        levels = c(\"AZ\", \"S\", \"GD\"),\r\n        labels = c(\r\n          \"Achtziger-Zupancic et al. (2017)\",\r\n          \"Snowdon et al. (2021)\",\r\n          \"Gonzalez-Duque et al. (2024)\"\r\n        )\r\n      ))\r\n\r\n  })\r\n\r\n  dataVK <- reactive({\r\n\r\n    data <- data.frame(\r\n      depth = c(2, seq(5, 45, 5), seq(50, 3500, 50))\r\n    ) %>%\r\n      mutate(\r\n        AZ = K_AZ(depth, input$AZ_A, input$AZ_B,  1,  input$AZ_m),\r\n        S = K_S(depth, input$S_a, input$S_b, input$S_y, input$S_d, input$S_e,  1, input$S_m),\r\n        GD = K_GD(depth, input$GD_Ks, input$GD_Kdl, input$GD_dl, input$GD_Dd, input$GD_Bd, input$GD_n, input$GD_m)\r\n      ) %>%\r\n      tidyr::pivot_longer(\r\n        cols = !depth,\r\n        names_to = \"approach\",\r\n        values_to = \"values\"\r\n      ) %>%\r\n      mutate(approach = factor(\r\n        x = approach,\r\n        levels = c(\"AZ\", \"S\", \"GD\"),\r\n        labels = c(\r\n          \"Achtziger-Zupancic et al. (2017)\",\r\n          \"Snowdon et al. (2021)\",\r\n          \"Gonzalez-Duque et al. (2024)\"\r\n        )\r\n      ))\r\n\r\n  })\r\n\r\n  output$distPlotHK <- renderPlotly({\r\n\r\n    build_plot(\r\n      data = dataHK(), \r\n      xlim = c(1e-8, 1e1), \r\n      ylim = c(3500, 0), \r\n      yby = 500, \r\n      xlab = \"VK, m/d\",\r\n      ylab = \"Depth, m\"\r\n    )\r\n    \r\n  })\r\n\r\n  output$distPlotVK <- renderPlotly({\r\n    \r\n    build_plot(\r\n      data = dataVK(),\r\n      xlim = c(1e-8, 1e1),\r\n      ylim = c(3500, 0),\r\n      yby = 500,\r\n      xlab = \"HK, m/d\",\r\n      ylab = \"Depth, m\"\r\n   )\r\n\r\n  })\r\n\r\n}\r\n\r\n# Run application --------------------------------------------------------------\r\n#devmode()\r\nshinyApp(ui = ui, server = server)\r\n\r\n\r\n# Turn app into HTML\r\n# shinylive::export(\r\n#   appdir = \"E:/Juan/RShinyApps/Rock_K\",\r\n#   destdir = \"E:/Juan/RShinyApps/Rock_K/site\",\r\n#   wasm_packages = TRUE\r\n# )\r\n# httpuv::runStaticServer(\"E:/Juan/RShinyApps/Rock_K/site\")\r\n\r\n","type":"text"},{"name":"Rock_K.Rproj","content":"Version: 1.0\r\n\r\nRestoreWorkspace: Default\r\nSaveWorkspace: Default\r\nAlwaysSaveHistory: Default\r\n\r\nEnableCodeIndexing: Yes\r\nUseSpacesForTab: Yes\r\nNumSpacesForTab: 2\r\nEncoding: UTF-8\r\n\r\nRnwWeave: Sweave\r\nLaTeX: pdfLaTeX\r\n","type":"text"},{"name":"helpers.R","content":"# Add link to a label\r\nshinyLink <- function(to, label) {\r\n  \r\n  tags$a(class = \"shiny__link\", href = to, label)\r\n  \r\n}\r\n\r\n# Rock K formulations\r\nK_AZ <- function(depth, A, B, n, m) {\r\n  \r\n  K = 10^(A * log10(depth / 1000) + B) * m / n * 9.81 * 1e6 * 86400\r\n  return(K)\r\n  \r\n}\r\n\r\nK_S <- function(depth, a, b, y, d, e, n, m) {\r\n  \r\n  K = 10^(b + (a - b) / (1 + (depth / y)^d)^e) * m / n  * 9.81 * 1e6 * 86400\r\n  return(K)\r\n  \r\n}\r\n\r\nK_GD <- function(depth, Ks, Kdl, dl, Dd, Bd, n, m) {\r\n  \r\n  depth = depth / 1000\r\n  As <- log10(Ks) / dl - log10(Kdl)\r\n  Ad <- -log10(Ks * exp(-As * dl) / dl^Bd)\r\n  \r\n  K = ifelse(\r\n    test = depth < dl,\r\n    yes = (Ks * exp(-As * depth)) * n * 9.81 * 1e6 * 86400,\r\n    no = (10^(-Ad) * (depth / Dd)^(-Bd)) * 9.81 * 1e6 * 86400\r\n  ) * m\r\n  \r\n  return(K)\r\n}\r\n\r\n# Generate multi-line plot using ggplot2\r\nbuild_plot <- function(data, xlim, ylim, yby, xlab, ylab) {\r\n  \r\n  plt <- ggplot(data = data, mapping = aes(x = values, y = depth, color = approach)) +\r\n    geom_line(linewidth = 0.75) +\r\n    coord_cartesian(xlim = xlim, ylim = ylim) +\r\n    scale_y_reverse(breaks = seq(ylim[2], ylim[1], yby)) +\r\n    scale_x_log10(breaks = 10^(log10(xlim[1]):log10(xlim[2])), position = \"top\") +\r\n    xlab(xlab) +\r\n    ylab(ylab) +\r\n    guides(color = guide_legend(nrow = 1)) +\r\n    theme_ipsum() +\r\n    theme(plot.margin=unit(rep(2,4), \"mm\"),\r\n          plot.subtitle = element_text(hjust = 0.5),\r\n          legend.margin=margin(2, 2, 2, 2, \"mm\"),\r\n          legend.position=\"bottom\",\r\n          legend.title=element_blank())\r\n    \r\n  ggplotly(plt) %>% layout(\r\n    legend = list(\r\n      orientation = \"h\",\r\n      xanchor = \"left\",\r\n      title = \"\"\r\n    ),\r\n    xaxis = list(\r\n      side = \"top\"\r\n    )\r\n  )\r\n  \r\n}","type":"text"}]
